
<%- include('../layouts/admin/header.ejs') %>

<div class="col-12">
  <div class="bg-light rounded h-100 p-4">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th id="allSelector" scope="col">All<input class="form-check-input" type="checkbox" value="" id="selectAll"></th>
            <th scope="col">Sl</th>
            <th scope="col">OrderID</th>
            <th scope="col">Amount</th>
            <th scope="col">Payment</th>
            <th scope="col">Status</th>
            <!--<th scope="col">Cancel Status</th>-->
          </tr>
        </thead>
        <tbody>
          <% if(order.length > 0) { %>
            <% for(let i = 0; i < order.length; i++) { %>
              <tr>
                <td><input class="form-check-input order-checkbox" type="checkbox" value="<%= order[i]._id %>" id="flexCheckDefault"></td>
                <td><%= i + 1 %></td>
                <td><%= order[i]._id %></td>
                <td><%= order[i].totalAmount %></td>
                <td><%= order[i].payment %></td>
                <td class="status">
                  <% if(order[i].status === false) { %>
                    <button class="btn btn-danger" onclick="updateStatus('<%= order[i]._id %>', <%= order[i].status %>)">Pending</button>
                  <% } else { %>
                    <button class="text-success btn btn-success text-light"><span>Paid</span></button>
                  <% } %>
                </td>
                <!--<td class="order-cancel"><%= order[i].orderStatus.success %></td>-->
              </tr>
            <% } %>
          <% } else { %>
            <tr>
              <td colspan="7">No orders found</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Table End -->

<script>

    function updateStatus(orderId, currentStatus) {
      const newStatus = !currentStatus;
      fetch(`/admin/updateOrderStatus`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ orderId: orderId, status: newStatus })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Failed to update status');
        }
      })
      .catch(error => console.error('Error:', error));
    }
  
    document.getElementById('selectAll').addEventListener('change', function() {
      const checkboxes = document.querySelectorAll('.order-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
    });
    function deleteOrder(orderId){
        fetch(`/admin/cancelOrder`,{
            method:'POST',
            headers:{
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ orderId: orderId })
        })
        .then(response=>response.json())
        .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Failed to delete order');
        }
      })
      .catch(error => console.error('Error:', error));
    }
  </script>

<%- include('../layouts/admin/footer.ejs') %>
